<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pet</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        :root {
            --bg-color: #f8e8f8;
            --frame-color: #e1bee7;
            --screen-bg: #fff0f5;
            --text-color: #8e24aa;
            --accent-color: #d1c4e9;
            --bar-good: #81c784;
            --bar-mid: #ffd54f;
            --bar-low: #e57373;
            --glitch-color: #ff0000;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--bg-color);
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
            transition: background-color 2s ease;
            user-select: none;
        }

        /* æ¸¸æˆæœºå¤–å£³ */
        .game-console {
            width: 320px;
            height: 500px;
            background-color: var(--frame-color);
            border-radius: 30px;
            padding: 20px;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            transition: all 1s ease;
        }

        /* å±å¹•åŒºåŸŸ */
        .screen {
            width: 280px;
            height: 280px;
            background-color: var(--screen-bg);
            border: 4px solid #fff;
            border-radius: 10px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            image-rendering: pixelated;
            transition: all 1s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* çŠ¶æ€æ¡ */
        .status-bar {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 10;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .icon { font-size: 12px; width: 20px; }

        .bar-container {
            width: 100px;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            width: 100%;
            background-color: var(--bar-good);
            transition: width 0.3s, background-color 0.3s;
        }

        /* å® ç‰©åŒºåŸŸ */
        .pet-container {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .pet {
            width: 100px;
            height: 100px;
            transition: transform 0.2s;
            position: relative;
        }

        /* åƒç´ ç”»ç»˜åˆ¶ (SVG) */
        .pixel-svg {
            width: 100%;
            height: 100%;
        }
        
        /* åˆå§‹å¯çˆ±å½¢æ€ */
        .pet-body { fill: #ff80ab; transition: fill 1s; }
        .pet-eye { fill: #4a148c; }
        .pet-mouth { fill: #4a148c; }
        .pet-blush { fill: #ff4081; opacity: 0.6; }
        
        /* ä¼ªè£…å¤–æ˜Ÿå½¢æ€ç»†èŠ‚ (éšè—) */
        .alien-vein { fill: none; stroke: #8b0000; stroke-width: 2; opacity: 0; transition: opacity 1s; }
        .alien-eye-inner { fill: #ff0000; opacity: 0; }

        /* æŒ‰é’®åŒºåŸŸ */
        .controls {
            display: flex;
            gap: 15px;
            width: 100%;
            justify-content: center;
        }

        .btn {
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background-color: #fff;
            box-shadow: 0 4px 0 #ccc;
            cursor: pointer;
            font-size: 20px;
            color: var(--text-color);
            transition: transform 0.1s, box-shadow 0.1s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #ccc;
        }

        /* åŠ¨ç”»ç±» */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .anim-bounce { animation: bounce 2s infinite; }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        @keyframes glitch-anim {
            0% { clip-path: inset(40% 0 61% 0); }
            20% { clip-path: inset(92% 0 1% 0); }
            40% { clip-path: inset(43% 0 1% 0); }
            60% { clip-path: inset(25% 0 58% 0); }
            80% { clip-path: inset(54% 0 7% 0); }
            100% { clip-path: inset(58% 0 43% 0); }
        }

        /* å´©åé˜¶æ®µæ ·å¼ */
        body.phase-1 {
            --bg-color: #2e2e2e;
            --frame-color: #4a4a4a;
            --screen-bg: #333;
            --text-color: #fff;
            --bar-good: #66bb6a;
        }
        
        body.phase-2 {
            --bg-color: #1a0000;
            --frame-color: #2b0000;
            --screen-bg: #110000;
            --text-color: #ff0000;
            --bar-good: #8b0000;
            --bar-mid: #500000;
            --bar-low: #ff0000;
        }

        body.phase-2 .pet {
            animation: shake 2s infinite;
        }
        
        body.phase-2 .screen::before {
            content: " ";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 0, 0, 0.1);
            pointer-events: none;
            z-index: 5;
            animation: flicker 0.1s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.1; }
            50% { opacity: 0.2; }
            100% { opacity: 0.1; }
        }

        /* ç»“å±€è¦†ç›–å±‚ */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            color: white;
            text-align: center;
            display: none;
        }

        #start-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #f8e8f8;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            cursor: pointer;
            flex-direction: column;
        }
        
        .blink { animation: opacityPulse 1s infinite; }
        @keyframes opacityPulse { 0%,100%{opacity:1;} 50%{opacity:0.5;} }

    </style>
</head>
<body>

    <!-- å¼€å§‹ç•Œé¢ (ä¸ºäº†éŸ³é¢‘ä¸Šä¸‹æ–‡) -->
    <div id="start-screen">
        <div style="font-size: 40px; color: #8e24aa; margin-bottom: 20px;">â™¥ P E T â™¥</div>
        <div class="blink" style="font-size: 12px; color: #8e24aa;">CLICK TO START</div>
    </div>

    <!-- ç»“å±€/æ¶ˆæ¯è¦†ç›–å±‚ -->
    <div id="overlay">
        <h1 id="end-title">TITLE</h1>
        <p id="end-desc" style="font-size: 10px; max-width: 80%; line-height: 1.5;"></p>
    </div>

    <div class="game-console">
        <div class="screen">
            <div class="status-bar">
                <div class="stat-row">
                    <span class="icon">ğŸ–</span>
                    <div class="bar-container"><div class="bar-fill" id="bar-hunger"></div></div>
                </div>
                <div class="stat-row">
                    <span class="icon">ğŸµ</span>
                    <div class="bar-container"><div class="bar-fill" id="bar-mood"></div></div>
                </div>
                <div class="stat-row">
                    <span class="icon">âš¡</span>
                    <div class="bar-container"><div class="bar-fill" id="bar-energy"></div></div>
                </div>
            </div>

            <div class="pet-container">
                <div class="pet anim-bounce" id="pet">
                    <svg viewBox="0 0 100 100" class="pixel-svg">
                        <!-- è§¦æ‰‹/èº«ä½“åº•å±‚ -->
                         <path class="alien-vein" d="M20,80 Q10,90 20,100 M80,80 Q90,90 80,100 M10,50 Q0,60 10,70" />
                        <!-- å¯çˆ±èº«ä½“ -->
                        <path class="pet-body" d="M20,80 Q10,50 20,30 Q30,10 50,10 Q70,10 80,30 Q90,50 80,80 Q50,90 20,80 Z" />
                        <!-- çœ¼ç› -->
                        <circle class="pet-eye" cx="35" cy="45" r="5" />
                        <circle class="pet-eye" cx="65" cy="45" r="5" />
                        <circle class="alien-eye-inner" cx="35" cy="45" r="2" />
                        <circle class="alien-eye-inner" cx="65" cy="45" r="2" />
                        <!-- è…®çº¢ -->
                        <circle class="pet-blush" cx="25" cy="55" r="4" />
                        <circle class="pet-blush" cx="75" cy="55" r="4" />
                        <!-- å˜´å·´ -->
                        <path class="pet-mouth" d="M45,55 Q50,60 55,55" fill="none" stroke="#4a148c" stroke-width="2" stroke-linecap="round" />
                    </svg>
                </div>
                <!-- è£…é¥°æ€§å¯¹è¯æ¡† -->
                <div id="dialog" style="position: absolute; top: 10px; right: 10px; font-size: 10px; color: var(--text-color); opacity: 0; transition: opacity 0.5s;">â™¥</div>
            </div>
        </div>

        <div class="controls">
            <button class="btn" onclick="interact('feed')">ğŸ–</button>
            <button class="btn" onclick="interact('play')">ğŸ¥</button>
            <button class="btn" onclick="interact('sleep')">ğŸ’¤</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let stats = {
            hunger: 50,
            mood: 50,
            energy: 50,
            corruption: 0 // éšè—æ•°å€¼ï¼šå¤–æ˜ŸåŒåŒ–åº¦
        };

        let gameActive = false;
        let loopId;
        let audioCtx;
        let bgmOscillators = [];

        // å…ƒç´ å¼•ç”¨
        const body = document.body;
        const pet = document.getElementById('pet');
        const barHunger = document.getElementById('bar-hunger');
        const barMood = document.getElementById('bar-mood');
        const barEnergy = document.getElementById('bar-energy');
        const dialog = document.getElementById('dialog');
        const overlay = document.getElementById('overlay');
        const startScreen = document.getElementById('start-screen');

        // å¯åŠ¨æ¸¸æˆ
        startScreen.addEventListener('click', () => {
            startScreen.style.display = 'none';
            initAudio();
            gameActive = true;
            startGameLoop();
            playMusic('happy');
        });

        // æ ¸å¿ƒå¾ªç¯
        function startGameLoop() {
            loopId = setInterval(() => {
                if (!gameActive) return;

                // è‡ªç„¶è¡°å‡
                stats.hunger -= 0.5;
                stats.mood -= 0.5;
                stats.energy -= 0.2;

                // è…èš€åº¦è‡ªç„¶å¢é•¿ (éšç€æ—¶é—´æ¨ç§»ï¼Œæ€ªç‰©ä¼ªè£…é€æ¸å¤±æ•ˆ)
                stats.corruption += 0.1; 

                // çŠ¶æ€è¾¹ç•Œæ£€æŸ¥
                checkBounds();
                updateVisuals();
                checkEndings();

            }, 500);
        }

        function interact(type) {
            if (!gameActive) return;
            
            playSFX(type);

            // æ¯æ¬¡äº’åŠ¨éƒ½ä¼šåŠ é€ŸåŒåŒ–ï¼ˆè…èš€ï¼‰
            stats.corruption += 1.5;

            switch(type) {
                case 'feed':
                    stats.hunger += 15;
                    stats.energy += 2;
                    showDialog(["Yummy!", "More...", "CONSUME"][getPhase()]);
                    petAnim('scale(1.1)', 200);
                    break;
                case 'play':
                    stats.mood += 15;
                    stats.hunger -= 5;
                    showDialog(["Fun!", "Obey.", "SUBMIT"][getPhase()]);
                    petAnim('rotate(10deg)', 200);
                    break;
                case 'sleep':
                    stats.energy += 20;
                    stats.hunger -= 10;
                    showDialog(["Zzz...", "Wait...", "DORMANCY"][getPhase()]);
                    document.querySelector('.screen').style.filter = 'brightness(0.5)';
                    setTimeout(() => document.querySelector('.screen').style.filter = '', 500);
                    break;
            }
            
            checkBounds();
            updateVisuals();
        }

        function checkBounds() {
            stats.hunger = Math.min(100, Math.max(0, stats.hunger));
            stats.mood = Math.min(100, Math.max(0, stats.mood));
            stats.energy = Math.min(100, Math.max(0, stats.energy));
            stats.corruption = Math.min(100, Math.max(0, stats.corruption));
        }

        function getPhase() {
            if (stats.corruption < 40) return 0; // èŒç³»
            if (stats.corruption < 80) return 1; // å´©å
            return 2; // ææ€–
        }

        function updateVisuals() {
            // æ›´æ–°è¿›åº¦æ¡
            updateBar(barHunger, stats.hunger);
            updateBar(barMood, stats.mood);
            updateBar(barEnergy, stats.energy);

            const phase = getPhase();

            // é˜¶æ®µè§†è§‰å˜åŒ–
            if (phase === 0) {
                body.className = '';
                setPetColors('#ff80ab', '#4a148c', 0, 0);
            } else if (phase === 1) {
                body.className = 'phase-1';
                setPetColors('#9c27b0', '#fff', 0.5, 0.2);
                // éšæœºæ•…éšœæ–‡å­—
                document.title = Math.random() > 0.9 ? "R_N" : "MoeMoe Alien";
                if(Math.random() > 0.8) glitchScreen();
            } else {
                body.className = 'phase-2';
                setPetColors('#3e0404', '#ff0000', 1, 1);
                // éŸ³ä¹å˜è°ƒ
                if(audioCtx && audioCtx.state === 'running') updateMusicPitch(0.5);
            }
        }

        function updateBar(el, value) {
            el.style.width = value + '%';
            if (value > 60) el.style.backgroundColor = 'var(--bar-good)';
            else if (value > 30) el.style.backgroundColor = 'var(--bar-mid)';
            else el.style.backgroundColor = 'var(--bar-low)';
        }

        function setPetColors(bodyColor, eyeColor, veinOpacity, innerEyeOpacity) {
            document.querySelector('.pet-body').style.fill = bodyColor;
            document.querySelectorAll('.pet-eye').forEach(e => e.style.fill = eyeColor);
            document.querySelector('.alien-vein').style.opacity = veinOpacity;
            document.querySelectorAll('.alien-eye-inner').forEach(e => e.style.opacity = innerEyeOpacity);
        }

        function petAnim(transform, time) {
            pet.style.transform = transform;
            setTimeout(() => pet.style.transform = 'none', time);
        }

        function showDialog(text) {
            dialog.innerText = text;
            dialog.style.opacity = 1;
            setTimeout(() => dialog.style.opacity = 0, 1000);
        }

        function glitchScreen() {
            const screen = document.querySelector('.screen');
            screen.style.transform = `translate(${Math.random()*4-2}px, ${Math.random()*4-2}px)`;
            screen.style.filter = 'invert(1)';
            setTimeout(() => {
                screen.style.transform = 'none';
                screen.style.filter = 'none';
            }, 100);
        }

        // ç»“å±€åˆ¤å®š
        function checkEndings() {
            // ç»“å±€1: å®Œå…¨åŒåŒ– (è…èš€åº¦æ»¡)
            if (stats.corruption >= 100) {
                triggerEnding("ASSIMILATION COMPLETE", "The host has been successfully replaced. Thank you for your nutrition.", "#000", "#f00");
            }
            // ç»“å±€2: å®¿ä¸»æ­»äº¡ (æ•°å€¼è¿‡ä½å¯¼è‡´æ€ªç‰©æš´èµ°)
            else if ((stats.hunger <= 0 || stats.mood <= 0) && stats.corruption > 50) {
                triggerEnding("HOST ELIMINATED", "Subject provided insufficient sustainment. Biomass consumed immediately.", "#300", "#fff");
            }
        }

        function triggerEnding(title, desc, bg, color) {
            gameActive = false;
            clearInterval(loopId);
            stopMusic();
            
            // æ’­æ”¾ææ€–éŸ³æ•ˆ
            playTone(100, 'sawtooth', 2);
            
            overlay.style.display = 'flex';
            overlay.style.background = bg;
            overlay.style.color = color;
            document.getElementById('end-title').innerText = title;
            document.getElementById('end-desc').innerText = desc;
        }

        // --- éŸ³é¢‘å¼•æ“ (Web Audio API) ---
        
        function initAudio() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
        }

        function playTone(freq, type, duration) {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.stop(audioCtx.currentTime + duration);
        }

        function playSFX(type) {
            if (!audioCtx) return;
            if (type === 'feed') {
                playTone(400, 'sine', 0.1);
                setTimeout(() => playTone(600, 'sine', 0.1), 100);
            } else if (type === 'play') {
                playTone(600, 'square', 0.1);
                setTimeout(() => playTone(800, 'square', 0.1), 100);
            } else {
                playTone(200, 'triangle', 0.5);
            }
        }

        // ç®€å•çš„èƒŒæ™¯éŸ³ä¹ç”Ÿæˆ
        function playMusic(style) {
            if (!audioCtx) return;
            
            // ç®€å•çš„ç¶éŸ³æ—‹å¾‹
            const notes = [330, 392, 440, 494, 523, 494, 440, 392]; // E G A B C B A G
            let noteIndex = 0;

            const playNextNote = () => {
                if(!gameActive) return;

                let freq = notes[noteIndex % notes.length];
                let type = 'sine';
                let interval = 250;

                // æ ¹æ®é˜¶æ®µæ‰­æ›²éŸ³ä¹
                if (stats.corruption > 50) {
                    freq = freq * (1 - (Math.random() * 0.1)); // èµ°è°ƒ
                    type = 'sawtooth'; // åˆºè€³
                    interval = 250 - (stats.corruption); // å˜å¿«
                }
                if (stats.corruption > 80) {
                    freq = freq / 2; // ä½æ²‰
                }

                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                osc.type = type;
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                
                gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);

                osc.connect(gain);
                gain.connect(audioCtx.destination);
                
                osc.start();
                osc.stop(audioCtx.currentTime + 0.2);

                noteIndex++;
                bgmTimer = setTimeout(playNextNote, interval);
            };

            playNextNote();
        }

        function stopMusic() {
            clearTimeout(window.bgmTimer);
        }
        
        function updateMusicPitch(rate) {
            // ç®€æ˜“å®ç°ï¼Œå®é™…é€»è¾‘é›†æˆåœ¨playNextNoteä¸­
        }

    </script>
</body>

</html>
